<!DOCTYPE html>
<html lang="es">


<head>
    <meta charset="utf-8">
    <title>CALCULADORA IGV PERÚ (2023 - CALCULA FACTURAS)</title>

    <!-- Google Ads -->
    <script data-ad-client="ca-pub-9690558669360580" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
        </script>
    <!-- FIN Google Ads -->

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110990909-1">
    </script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-110990909-1');
    </script>
    <!-- FIN  Google Analytics -->

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="cs.css">
    <meta name="viewport" content="width=device-width, 
            initial-scale=1.0,
            user-scalable=no">
</head>

<!-- CLEVERNET DISABLED -->
<script data-cfasync="false" type="text/javascript" id="clever-core">
    (function (document, window) {
        var a, c = document.createElement("script");

        c.id = "CleverCoreLoader57852";
        c.src = "//scripts.cleverwebserver.com/b3c8fb045ba4d7b395b3e319d98fa17f.js";

        c.async = !0;
        c.type = "text/javascript";
        c.setAttribute("data-target", window.name);
        c.setAttribute("data-callback", "put-your-callback-macro-here");

        try {
            a = parent.document.getElementsByTagName("script")[0] || document.getElementsByTagName("script")[0];
        } catch (e) {
            a = !1;
        }

        a || (a = document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]);
        a.parentNode.insertBefore(c, a);
    })(document, window);
</script>
<!-- FIN CLEVERNET DISABLED -->



<body>

    <h1>CALCULADORA IGV PERÚ</h1>

    <!--Selector Basico Avanzado -->
    <div class="divBasicoAvanzado" onclick="swBasicoAvanzado()">
        <div id="divCalcAvanzado">Avanzado</div>
        <div id="divCalcBasico">Básico</div>
    </div>
    <div class="clear"></div>
    <section class="contenedorFactura">
        <!--CALCULADORA AVANZADA -->
        <div id="calculadoraAvanzada">
            <!--filas factura-->
            <div class="factContenedor">

                <div class="factFilaTitulo">
                    <div class="factTitUnid">
                        Unid.
                    </div>
                    <div class="factTitPUnid">
                        P.Unidad
                    </div>
                    <div class="factTitBorrar" onclick="borraTodo()">
                        &#x21BB;
                    </div>
                    <div class="factTitPTotal">
                        Sub.Total
                    </div>

                </div>

            </div>

            <!--fila add-->
            <div class="factContenedor">
                <button class="factAddFila  hPointer" onclick="addFila()">
                    <div style="width:100%;
                        color: green;">&#10010;</div>
                </button>
                <div class="factTipoIGV">
                    <label class="hPointer"><input type="checkbox" id="incIGV" onchange="calculaTotales()">
                        Precios incluyen
                        IGV </label>
                </div>
            </div>

            <!--fila add-->
            <div class="factContenedor">
                <div class="factTipoIGV">
                    <label class="hPointer"><input type="checkbox" id="showDescripcion"
                            onchange="showHideDescripcion()">
                        Descripción de Productos</label>
                </div>
            </div>

            <!--monto base igv total-->
            <div class="factContenedor">
                <table class="tablaFactResultado">
                    <tr>
                        <td>Monto Base</td>
                        </td>
                        <td>: S/</td>
                        <td nowrap id="cellBase">
                        </td>
                    </tr>
                    <tr>
                        <td>IGV <label id="valorIgv"></label>%</td>
                        </td>
                        <td>: S/</td>
                        <td nowrap id="cellIGV">
                        </td>
                    </tr>
                    <tr>
                        <td>Total</td>
                        </td>
                        <td>: S/</td>
                        <td nowrap id="cellTotal">
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!--CALCULADORA BASICA -->
        <div class="factContenedor" id="calculadoraBasica">
            <section>
                <div class="fila">
                    <div class="tituloInput">
                        Monto Base -Basic
                    </div>
                    <div class="valoresInput">
                        <input class="inputGrande" id="docBase" type="number" onchange="calcularBasico(this)"
                            onclick="calcularBasico(this)" onfocusout="fixed(this)" onkeyup="calcularBasico(this)" />
                    </div>
                </div>
                <div class="clear"></div>

                <div class="fila">
                    <div class="tituloInput">
                        IGV <label id="docPorcentaje">
                            18%
                        </label>
                    </div>
                    <div class="valoresInput">
                        <input class="inputGrande" id="docIVA" onchange="calcularBasico(this)"
                            onclick="calcularBasico(this)" onfocusout="fixed(this)" onkeyup="calcularBasico(this)"
                            type="number" />
                    </div>
                </div>
                <div class="clear"></div>

                <div class="fila">
                    <div class="tituloInput">
                        Total
                    </div>
                    <div class="valoresInput">
                        <input class="inputGrande" id="docTotal" onchange="calcularBasico(this)"
                            onclick="calcularBasico(this)" onfocusout="fixed(this)" onkeyup="calcularBasico(this)"
                            type="number" />
                    </div>
                </div>
                <br>
        </div>

        <!--escritura y fecha-->
        <div class="factContenedor">
            <div>
                SON :
            </div>
            <div id="divEscrituraAvanzado">
                ...
            </div>
            <div id="divEscrituraBasico">
                ...
            </div>
            <div style="margin-top: 1rem;">
                Fecha del Sistema :
            </div>
            <div id="divFecha">
                ...
            </div>
        </div>

    </section> 
    </div>

    <script>
        // VARIABLES  
        var ultimoValor = 0;
        var calculadoraAvanzada = document.getElementById("calculadoraAvanzada");
        var calculadoraBasica = document.getElementById("calculadoraBasica");
        calculadoraAvanzada.hidden = true;
        calculadoraBasica.hidden = false;

        var contenedor = document.getElementsByClassName("factContenedor")[0];
        var activaGenerarEscritura = setTimeout(generarEscritura, 100000);
        var timeOutEscribeBasico = setTimeout(generarEscrituraBasico, 100000);
        var modificar = true;
        var ocultarDescripcion = !(document.getElementById("showDescripcion").checked);
        var valorIgv = document.getElementById("valorIgv");
        var IvaPorciento = 18;
        valorIgv.innerHTML = IvaPorciento;

        var nomMonedaPlural = "SOLES";
        var nomMonedaSingular = "SOL";

        var divLog = document.getElementById("divLog");
        var incIGV = document.getElementById("incIGV");
        incIGV.checked = true;
        var ultimoTotal = 0;
        var maxDecimales = 2;
        var maxUnid = 10000;
        var maxPUnid = 10000000;
        var maxPTot = 100000000000;
        var jEscritura = {};

        // selector Básico Avanzado
        var divCalcBasico = document.getElementById("divCalcBasico");
        var divCalcAvanzado = document.getElementById("divCalcAvanzado");
        divEscrituraBasico = document.getElementById("divEscrituraBasico");
        divEscrituraAvanzado = document.getElementById("divEscrituraAvanzado");
        setBasico()

        var jOldBasico = {};
        var jMaxBasico = {};
        jMaxBasico["docTotal"] = 100000000000;
        jMaxBasico["docBase"] = Math.round(jMaxBasico["docTotal"] * 100 / (100 + IvaPorciento));
        jMaxBasico["docIVA"] = Math.round(jMaxBasico["docTotal"] * IvaPorciento / (100 + IvaPorciento));
        setValoresPrevios();

        // ------------------
        updFecha();
        addFila();

        function swBasicoAvanzado() {
            if (divCalcAvanzado.getAttribute("class") == "selectorActivo") { // si es Avanzado cambio a Básico
                setBasico()
            } else { // si es Básico cambio a Avanzado
                setAvanzado()
            }
        }
        function setAvanzado() {
            divCalcBasico.setAttribute("class", "selectorNoActivo")
            divCalcAvanzado.setAttribute("class", "selectorActivo")
            calculadoraBasica.hidden = true
            calculadoraAvanzada.hidden = false
            divEscrituraBasico.hidden = true;
            divEscrituraAvanzado.hidden = false;
        }
        function setBasico() {
            divCalcBasico.setAttribute("class", "selectorActivo")
            divCalcAvanzado.setAttribute("class", "selectorNoActivo")
            calculadoraBasica.hidden = false;
            calculadoraAvanzada.hidden = true;
            divEscrituraBasico.hidden = false;
            divEscrituraAvanzado.hidden = true;
        }

        contenedor.children[1].children[0].children[0].focus()

        function setUltimoValor(valor) {
            ultimoValor = valor
        }

        function addFila() {
            var filas = contenedor.children

            var f, div, inp
            // div fila
            f = document.createElement("div");
            f.setAttribute("class", "factFila")

            // div Descripción
            div = document.createElement("div")
            f.appendChild(div)
            inp = document.createElement("input")
            inp.setAttribute("placeholder", "Producto")
            div.setAttribute("class", "divDescripcion")
            div.hidden = ocultarDescripcion
            div.appendChild(inp)

            // div unidades
            div = document.createElement("div")
            div.setAttribute("class", "factUnidades")
            f.appendChild(div)
            inp = crearInputNumeros()
            inp.setAttribute("placeholder", "Cantidad")
            div.appendChild(inp)

            // div p.undad
            div = document.createElement("div")
            div.setAttribute("class", "factPrecio")
            f.appendChild(div)
            inp = crearInputNumeros()
            inp.setAttribute("placeholder", "P.Unidad")
            div.appendChild(inp)

            // div borraFila
            div = document.createElement("div")
            div.setAttribute("class", "factBorraFila hPointer")
            div.setAttribute("onclick", "delFila(this)")
            f.appendChild(div)
            inp = document.createElement("strong")
            inp.innerHTML = "&#10060;";
            div.appendChild(inp)

            // div subTotal
            div = document.createElement("div")
            div.setAttribute("class", "factSubTotal")
            f.appendChild(div)
            inp = crearInputNumeros()
            inp.setAttribute("placeholder", "Total.Producto")
            div.appendChild(inp)
            contenedor.appendChild(f)
            f.children[f.children.length - 4].children[0].focus()
        }

        function crearInputNumeros() {
            var inp = document.createElement("input")
            inp.setAttribute("type", "number")
            inp.setAttribute("inputmode", "numeric")
            inp.setAttribute("onchange", "calculaFila(this)")
            inp.setAttribute("onkeyup", "calculaFila(this)")
            inp.setAttribute("onkeypress", "setUltimoValor(this.value)")
            inp.setAttribute("onblur", "lostFocus(this)")
            inp.setAttribute("onfocus", "this.select()")
            return inp
        }

        function delFila(obj) {
            var fila = obj.parentNode
            fila.remove()
            if (contenedor.children.length <= 1) addFila()
            calculaTotales()
        }

        function borraTodo() {
            var filas = contenedor.children.length - 1
            while (contenedor.children.length > 1) {
                contenedor.children[1].remove()
            }
            addFila()
            calculaTotales()
        }

        function calculaFila(obj) {
            validaValor(obj)

            if (!modificar) return;
            modificar = false;

            // definición de inputs
            var clase = obj.parentNode.getAttribute("class")
            var fila = obj.parentNode.parentNode
            var lista = fila.children
            var n = lista.length
            var inputUnid = lista[n - 4].children[0]
            var inputPunid = lista[n - 3].children[0]
            var inputPtot = lista[n - 1].children[0]

            var aux;
            if (obj === inputUnid) {
                aux = 1
                    * inputUnid.value.split(",").join(".")
                    * inputPunid.value.split(",").join(".");
                inputPtot.value = aux.toFixed(maxDecimales)
            } else if (obj === inputPunid) {
                if (inputUnid.value == "") inputUnid.value = "1"
                aux = 1
                    * inputUnid.value.split(",").join(".")
                    * inputPunid.value.split(",").join(".");
                inputPtot.value = aux.toFixed(maxDecimales)
            } else {
                if (inputUnid.value * 1 == 0) inputUnid.value = "1"
                aux = 1
                    * inputPtot.value.split(",").join(".") / inputUnid.value.split(",").join(".")
                inputPunid.value = aux.toFixed(maxDecimales)
            }

            calculaTotales()
            modificar = true
        }

        function validaValor(obj) {
            // definición de inputs
            var fila = obj.parentNode.parentNode
            var lista = fila.children
            var n = lista.length
            var inputUnid = lista[n - 4].children[0]
            var inputPunid = lista[n - 3].children[0]
            var inputPtot = lista[n - 1].children[0]

            var maximo
            if (obj === inputUnid) maximo = maxUnid
            if (obj === inputPunid) maximo = maxPUnid
            if (obj === inputPtot) maximo = maxPTot

            valor = obj.value.split(",").join(".")
            // corrección de input

            // mas de un punto
            if (valor.split(".").length > 2) {
                obj.value = ultimoValor;
                if (ultimoValor > maximo) obj.value = maximo
                return
            }

            // solo numeros
            if (obj.value.search(/[^0-9\.]/g) >= 0) {
                obj.value = ultimoValor;
                if (ultimoValor > maximo) obj.value = maximo
                return
            }

            // num decimales
            valor = obj.value.split(",").join(".")

            var decimales = (obj === inputUnid) ? 2 : maxDecimales;
            if (valor.split(".")[1]) {
                if (valor.split(".")[1].length > decimales) {
                    if (decimales > 0) {
                        obj.value = (valor.split(".")[0]
                            + "."
                            + valor.split(".")[1].substring(0, decimales))
                    } else {
                        obj.value = valor.split(".")[0]
                    }
                    return
                }
            }

            // solo ceros
            if (valor.search('^0{2,}$') == 0) {
                obj.value = 0
                return
            }

            // inicia en cero
            if (valor.search('^0[1-9]{1,}') == 0) {
                obj.value = 1 * obj.value
                return
            }


            // maximo Unidades
            if (obj === inputUnid) {
                if (valor > maxUnid || 1 * valor * inputPunid.value > maxPTot) {
                    inputUnid.value = ultimoValor
                    if (ultimoValor > maxUnid) inputUnid.value = maximo
                    return
                }
            }
            if (obj === inputPunid) {
                if (valor > maxPUnid || 1 * valor * inputUnid.value > maxPTot) {
                    inputPunid.value = ultimoValor
                    if (ultimoValor > maxPUnid) inputPunid.value = maxPUnid
                    return
                }
            }
            if (obj === inputPtot) {
                if (valor > maxPTot) {
                    inputPtot.value = ultimoValor
                    if (ultimoValor > maxPTot) inputPtot.value = maxPTot
                    return
                }
            }
        }

        function calculaTotales() {
            var filas = contenedor.children
            var subtotal = 0
            var i, valor;
            for (i = 1; i < filas.length; i++) {
                valor = filas[i].children[filas[i].children.length - 1].children[0].value
                subtotal += 1 * valor
            }
            document.getElementById("cellBase").setAttribute("style", "color:#AAA")
            document.getElementById("cellIGV").setAttribute("style", "color:#AAA")
            document.getElementById("cellTotal").setAttribute("style", "color:#AAA")
            var montoBase, igv, total
            if (incIGV.checked == true) {
                total = 1 * subtotal
                montoBase = 1 * total / (1 + IvaPorciento / 100)
                igv = total - montoBase
                document.getElementById("cellTotal").setAttribute("style", "color:black")
            } else {
                montoBase = 1 * subtotal
                igv = montoBase * (IvaPorciento / 100)
                total = montoBase + igv
                document.getElementById("cellBase").setAttribute("style", "color:black")
            }

            document.getElementById("cellBase").innerHTML =
                addSpaces(montoBase.toFixed(maxDecimales));
            document.getElementById("cellIGV").innerHTML =
                addSpaces(igv.toFixed(maxDecimales));
            document.getElementById("cellTotal").innerHTML =
                addSpaces(total.toFixed(maxDecimales));

            if (total == ultimoTotal) return
            ultimoTotal = total

            escribeBasico('...', '...', divEscrituraAvanzado)
            clearTimeout(activaGenerarEscritura)
            activaGenerarEscritura = setTimeout(generarEscritura, 400)
        }

        function addSpaces(num) {
            var ent = num.split(".")[0]
            var result = ent.substring(ent.length - 3, ent.length)
            for (var i = ent.length - 3; i > 0; i = i - 3) {
                result = ent.substring(i - 3, i) + " " + result
            }
            if (num.split(".").length > 1) {
                result = result + "." + num.split(".")[1]
            }
            return result
        }

        function lostFocus(obj) {
            var valor = 1 * obj.value
            var inputUnid = obj.parentNode.parentNode.children[1].children[0]
            if (obj === inputUnid) {
                if (obj.value != "") obj.value = valor
            } else {
                obj.value = ""
                obj.value = valor.toFixed(maxDecimales)
            }
        }

        function generarEscritura() {
            var resultado
            var http = new XMLHttpRequest();
            var url = '/aletrasv2.php';
            var totalx100 = "00" + parseInt(Math.round(100 * cellTotal.innerHTML.split(" ").join("")));
            var params = 'totalx100=' + totalx100 + '&tipo=A';
            console.log(params)
            if (jEscritura.hasOwnProperty(params)) {
                escribeBasico(jEscritura[params], params, divEscrituraAvanzado);
                return;
            }

            http.open("POST", url, true);
            http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

            http.onreadystatechange = function () {//Call a function when the state changes.
                if (http.readyState == 4 && http.status == 200) {
                    resultado = http.responseText
                    escribeBasico(resultado, params, divEscrituraAvanzado);
                }
            }
            http.send(params);
        }

        function updFecha() {
            var fecha = new Date();
            var dia = fecha.getDate();
            var nMes = fecha.getMonth() * 1;
            var anho = fecha.getFullYear();
            var meses = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Setiembre", "Octubre", "Noviembre", "Diciembre"];
            var mes = meses[nMes];
            divFecha.innerHTML = "" + dia + " de " + mes + " del " + anho;
        }

        function showHideDescripcion() {
            var lista = document.getElementsByClassName("divDescripcion")
            for (var i = 0; i < lista.length; i++) {
                ocultarDescripcion = !(document.getElementById("showDescripcion").checked)
                lista[i].hidden = ocultarDescripcion

            }
        }

        // BASICO
        function calcularBasico(objeto) {
            if (!modificar) return;
            modificar = false;
            validarValorBasico(objeto)
            let docBase = document.getElementById("docBase");
            let docIVA = document.getElementById("docIVA");
            let docTotal = document.getElementById("docTotal");
            if (objeto.id == "docBase") {
                docIVA.value = (docBase.value * ((100 + IvaPorciento) / 100 - 1)).toFixed(maxDecimales)
                docTotal.value = (1 * docBase.value + 1 * docIVA.value).toFixed(maxDecimales)
            }
            if (objeto.id == "docIVA") {
                docBase.value = (docIVA.value * 100 / IvaPorciento).toFixed(maxDecimales)
                docTotal.value = (1 * docBase.value + 1 * docIVA.value).toFixed(maxDecimales)
            }
            if (objeto.id == "docTotal") {
                docBase.value = (docTotal.value / (100 + IvaPorciento) * 100).toFixed(maxDecimales)
                docIVA.value = (1 * docTotal.value - 1 * docBase.value).toFixed(maxDecimales)
            }

            if (jOldBasico["totalx100"] != "00" + parseInt(Math.round(100 * docTotal.value))) {
                clearTimeout(timeOutEscribeBasico)
                escribeBasico("...", "...", divEscrituraBasico)
                timeOutEscribeBasico = setTimeout(generarEscrituraBasico, 500);
            }
            jOldBasico["totalx100"] = "00" + parseInt(Math.round(100 * docTotal.value));
            modificar = true;
        }

        function fixed(objeto) {
            objeto.value = (1 * objeto.value).toFixed(maxDecimales)
        }

        function validarValorBasico(obj) {
            var valor = obj.value.split(",").join(".")

            // num decimales
            var decimales = maxDecimales;
            if (valor.split(".")[1]) {
                if (valor.split(".")[1].length > maxDecimales) {
                    if (maxDecimales > 0) {
                        obj.value = (valor.split(".")[0]
                            + "."
                            + valor.split(".")[1].substring(0, maxDecimales))
                    } else {
                        obj.value = valor.split(".")[0]
                    }
                    return
                }
            }

            // solo ceros
            if (valor.search('^0{2,}$') == 0) {
                obj.value = 0
                setValoresPrevios()
                return
            }

            // inicia en cero
            if (valor.search('^0[1-9]{1,}') == 0) {
                obj.value = 1 * obj.value
                setValoresPrevios()
                return
            }

            // maximo Unidades
            if (1 * valor > 1 * jMaxBasico[obj.id]) {
                obj.value = jOldBasico[obj.id];
                if (1 * jOldBasico[obj.id] > 1 * jMaxBasico[obj.id]) {
                    obj.value = jMaxBasico[obj.id];
                }
                setValoresPrevios()
                return
            }

            setValoresPrevios()

            return
            var texto = "" + docVariable.value
            var longitud = texto.length
            var posicionPunto = texto.indexOf('.')
            if (posicionPunto < 0) posicionPunto = longitud
            if (1 * texto < 0 || posicionPunto > 9 || longitud - posicionPunto > 3 || 1 * texto - 1 * valorMaximo > 0) {
                setValoresPrevios()
            }
        }

        function setValoresPrevios() {
            jOldBasico["docBase"] = docBase.value;
            jOldBasico["docIVA"] = docIVA.value;
            jOldBasico["docTotal"] = docTotal.value;
        }

        function generarEscrituraBasico() {
            var resultado;

            var http = new XMLHttpRequest();
            var url = '/aletrasv2.php';
            var totalx100 = "00" + parseInt(Math.round(100 * docTotal.value));
            var params = 'totalx100=' + totalx100 + '&tipo=B';

            if (jEscritura.hasOwnProperty(params)) { // si texto ya existe
                escribeBasico(jEscritura[params], params, divEscrituraBasico);
                return;
            }
            escribeBasico("...", "...", divEscrituraBasico)
            http.open("POST", url, true);
            http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            http.onreadystatechange = function () {
                if (http.readyState == 4 && http.status == 200) {
                    resultado = http.responseText;
                    escribeBasico(resultado, params, divEscrituraBasico);
                }
            }
            http.send(params);
        }

        function escribeBasico(texto, params, objDivEscritura) {
            jOldBasico[params] = params
            // 
            jEscritura[params] = texto
            //
            if (texto == "...") {
                objDivEscritura.innerHTML = texto
                return
            }
            if (maxDecimales == 0) {
                texto = texto.replace(" CON 00/100", "");
                if (texto.substring(texto.length - 3) == "UNO") {
                    texto = texto.substring(0, texto.length - 1)
                }
            }

            if (texto.search("--") != 0) {
                texto = texto + " " + nomMonedaPlural
            }
            if (texto == " UN " + nomMonedaPlural)
                texto = "UN " + nomMonedaSingular;
            objDivEscritura.innerHTML = texto
        }

    </script>

</body>

</html>